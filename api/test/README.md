# Модульные тесты для API-сервера

## Установка

Необходимо установить зависимости из директории выше (`/api`):

```sh
$ npm i
```

## Запуск

Запуск также необходимо осуществлять из корневой директории API-сервера:

```sh
$ npm test
```

## Структура

* `index.js` - здесь хранятся все тесты
* `repos.zip` - архив с тестовыми репозиториями

## Логические блоки

Тесты сгруппированны по эндпоинтам. В каждой группе содержится успешный случай и 1-2 неуспешных случая обращения к эндпоинту, которые, как мне показалось, покрывают основные сценарии работы с ними (обращение к существующему или несуществующему репозиторию, например). Честно говоря, не знаю, что еще можно сюда добавить, ведь тесты достаточно примитивны :)

## Немного о ходе работы

Я использовал следующий подход для написания тестов: у нас есть тестовые репозитории, к которым обращаются экземпляры API-сервера во время вызова методов API-сервера и затем, поскольку содержимое тестовых репозиториев нам известно и зафиксировано, мы сверяем результаты работы методов (заголовки и тело HTTP-запроса) с ожидаемым результатом.

Подход этот, вероятно, достаточно плох, но мне пришлось пойти на компромисс между моим мизерным опытом (писал тесты во второй раз: первый раз был на вступительном задании) и имеющимся временем (всю прошлую неделю целиком потратил на работу над домашкой по реакту).

Идею с созданием тестовых репозиториев, их упаковкой в архив и распаковкой мне подсказал [@VladislavYeremeyev](https://github.com/VladislavYeremeyev).

## Инструменты

### chai
Библиотека для тестирования. Помимо `describe`, `context` и `it` в некоторых местах, где supertest не справляется, используется `chai.expect`.

### supertest
Библиотека необходима для имитации работы сервера. С ее помощью отправляются запросы на сервер и проверяется соответствие заголовка и тела ответов ожидаемому результату при помощи метода `expect`.

### axios
Необходим для отправки вспомогательных запросов на сервер, которые напрямую к `supertest` не относятся (клонирование и удаление тестовых репозиториев).

### AdmZip
Необходим для распаковки архива тестовых репозиториев.

### rimraf
Необходим для удаления директории, в которой хранятся распакованные тестовые репозитории.